<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{LvsAreas/LvsAdmin/LvsLayout/LvsAdmin-layout}" lang="vi">

<head>
    <title>Chỉnh sửa Danh mục</title>

    <style>
        :root {
            --primary-color: #4361ee;
            --success-color: #06d6a0;
            --warning-color: #ffd166;
            --danger-color: #ef476f;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --gray-color: #6c757d;
        }

        body {
            background: #f4f7fc;
        }

        .edit-container {
            max-width: 1100px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color), #3a56d4);
            border-radius: 16px;
            padding: 2.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 800;
        }

        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.85;
        }

        .form-card {
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border-top: 4px solid var(--primary-color);
        }

        .form-section {
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #f0f4f8;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.6rem;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #d1d9e6;
            padding: 0.9rem 1.2rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.1);
        }

        .help-text {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-top: 0.4rem;
        }

        .preview-box {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 2px dashed #d1d9e6;
            margin-top: 1rem;
            transition: border-color 0.3s;
        }

        .preview-box:hover {
            border-color: var(--primary-color);
        }

        .icon-preview {
            font-size: 3.5rem;
            color: var(--primary-color);
        }

        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
            gap: 0.75rem;
            max-height: 280px;
            overflow-y: auto;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #d1d9e6;
        }

        .icon-option {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            background: white;
            border: 2px solid transparent;
            height: 55px;
        }

        .icon-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .icon-option.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .color-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 3px solid transparent;
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .color-option.active {
            border-color: var(--dark-color);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1.5rem;
        }

        .btn {
            border-radius: 10px;
            padding: 0.9rem 1.8rem;
            font-weight: 600;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .edit-container {
                padding: 0.5rem;
            }

            .form-card {
                padding: 1.5rem;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="edit-container">
        <!-- Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="page-title">
                        <i class="fas fa-edit me-2"></i>
                        Chỉnh sửa Danh mục
                    </h1>
                    <p class="page-subtitle mb-0">
                        ID: <span th:text="${LvsCategory.lvsCategoryId}"></span>
                    </p>
                </div>
                <a th:href="@{/LvsAdmin/LvsCategory/LvsDetail/{id}(id=${LvsCategory.lvsCategoryId})}"
                   class="btn btn-light">
                    <i class="fas fa-arrow-left me-2"></i>
                    Quay lại
                </a>
            </div>
        </div>

        <!-- Alert Messages -->
        <div th:if="${LvsError}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-triangle me-3 fs-4"></i>
                <div>
                    <strong>Lỗi!</strong>
                    <div class="mt-1" th:text="${LvsError}"></div>
                </div>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Main Form -->
        <div class="form-card">
            <form th:action="@{/LvsAdmin/LvsCategory/LvsEdit/{id}(id=${LvsCategory.lvsCategoryId})}"
                  method="post" th:object="${LvsCategory}" id="editCategoryForm">

                <!-- Hidden ID field -->
                <input type="hidden" th:field="*{lvsCategoryId}" />

                <!-- Basic Information Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Thông tin cơ bản
                    </h3>

                    <div class="row">
                        <div class="col-md-8 mb-4">
                            <label for="categoryName" class="form-label required-field">
                                <i class="fas fa-tag"></i>
                                Tên danh mục
                            </label>
                            <input type="text" class="form-control" id="categoryName"
                                   th:field="*{lvsCategoryName}" required
                                   placeholder="Nhập tên danh mục...">
                            <div class="help-text">
                                Tên nên ngắn gọn, mô tả đúng nội dung. Tối đa 100 ký tự.
                            </div>
                        </div>

                        <div class="col-md-4 mb-4">
                            <label for="sortOrder" class="form-label">
                                <i class="fas fa-sort-numeric-down"></i>
                                Thứ tự sắp xếp
                            </label>
                            <input type="number" class="form-control" id="sortOrder"
                                   th:field="*{lvsSortOrder}" min="0" max="999">
                            <div class="help-text">Số nhỏ hơn hiển thị trước</div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="description" class="form-label">
                            <i class="fas fa-align-left"></i>
                            Mô tả
                        </label>
                        <textarea class="form-control" id="description" rows="3"
                                  th:field="*{lvsDescription}"
                                  placeholder="Mô tả ngắn về danh mục..."></textarea>
                        <div class="help-text">
                            Tối đa 500 ký tự.
                            <span class="float-end">
                                <span id="charCount" th:text="${#strings.length(LvsCategory.lvsDescription)}">0</span>/500
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Appearance Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-palette"></i>
                        Giao diện hiển thị
                    </h3>

                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="form-label">
                                <i class="fas fa-icons"></i>
                                Biểu tượng
                            </label>
                            <div class="input-group mb-3">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="iconInput"
                                       th:field="*{lvsIcon}"
                                       placeholder="fas fa-folder hoặc chọn bên dưới">
                                <button class="btn btn-outline-secondary" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#iconSelector">
                                    <i class="fas fa-th"></i>
                                </button>
                            </div>

                            <!-- Icon Preview -->
                            <div class="preview-box">
                                <div class="icon-preview">
                                    <i id="iconPreview" th:class="${LvsCategory.lvsIcon} ?: 'fas fa-question-circle'"></i>
                                </div>
                                <div class="text-muted small" id="iconText">
                                    <span th:text="${LvsCategory.lvsIcon} ?: 'Chưa chọn icon'"></span>
                                </div>
                            </div>

                            <!-- Icon Selector -->
                            <div class="collapse mt-3" id="iconSelector">
                                <div class="icon-grid">
                                    <div class="icon-option" data-icon="fas fa-folder">
                                        <i class="fas fa-folder"></i>
                                    </div>
                                    <div class="icon-option" data-icon="fas fa-folder-open">
                                        <i class="fas fa-folder-open"></i>
                                    </div>
                                    <div class="icon-option" data-icon="fas fa-project-diagram">
                                        <i class="fas fa-project-diagram"></i>
                                    </div>
                                    <div class="icon-option" data-icon="fas fa-tasks">
                                        <i class="fas fa-tasks"></i>
                                    </div>
                                    <div class="icon-option" data-icon="fas fa-layer-group">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="icon-option" data-icon="fas fa-box">
                                        <i class="fas fa-box"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6 mb-4">
                            <label class="form-label">
                                <i class="fas fa-palette"></i>
                                Màu sắc
                            </label>
                            <div class="input-group mb-3">
                                <span class="input-group-text">
                                    <i class="fas fa-tint"></i>
                                </span>
                                <input type="text" class="form-control" id="colorInput"
                                       th:field="*{lvsColor}"
                                       placeholder="#4361ee hoặc chọn bên dưới">
                                <button class="btn btn-outline-secondary" type="button"
                                        onclick="openColorPicker()">
                                    <i class="fas fa-eyedropper"></i>
                                </button>
                            </div>

                            <!-- Color Preview -->
                            <div class="preview-box">
                                <div class="mb-3">
                                    <div class="color-preview mx-auto" id="colorPreview"
                                         th:style="'background-color:' + (${LvsCategory.lvsColor} ?: '#e9ecef')"></div>
                                </div>
                                <div class="text-muted small">
                                    Mã màu: <code id="colorText" th:text="${LvsCategory.lvsColor} ?: 'Mặc định'"></code>
                                </div>
                            </div>

                            <!-- Color Presets -->
                            <label class="form-label mt-3">Màu sắc phổ biến:</label>
                            <div class="color-grid">
                                <div class="color-option" style="background-color: #4361ee;"
                                     data-color="#4361ee"></div>
                                <div class="color-option" style="background-color: #06d6a0;"
                                     data-color="#06d6a0"></div>
                                <div class="color-option" style="background-color: #ffd166;"
                                     data-color="#ffd166"></div>
                                <div class="color-option" style="background-color: #ef476f;"
                                     data-color="#ef476f"></div>
                                <div class="color-option" style="background-color: #7209b7;"
                                     data-color="#7209b7"></div>
                                <div class="color-option" style="background-color: #3a0ca3;"
                                     data-color="#3a0ca3"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-toggle-on"></i>
                        Trạng thái
                    </h3>

                    <div class="mb-4">
                        <label class="form-label d-block mb-3">
                            <i class="fas fa-power-off"></i>
                            Trạng thái hoạt động
                        </label>

                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="lvsIsActive"
                                   id="activeTrue" th:field="*{lvsIsActive}" th:value="true">
                            <label class="btn btn-outline-success" for="activeTrue">
                                <i class="fas fa-check-circle me-2"></i>
                                Đang hoạt động
                            </label>

                            <input type="radio" class="btn-check" name="lvsIsActive"
                                   id="activeFalse" th:field="*{lvsIsActive}" th:value="false">
                            <label class="btn btn-outline-danger" for="activeFalse">
                                <i class="fas fa-times-circle me-2"></i>
                                Vô hiệu hóa
                            </label>
                        </div>
                        <div class="help-text">
                            Danh mục vô hiệu hóa sẽ không hiển thị trong danh sách chọn
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                        <i class="fas fa-redo me-2"></i>
                        Khôi phục
                    </button>

                    <div>
                        <a th:href="@{/LvsAdmin/LvsCategory/LvsDetail/{id}(id=${LvsCategory.lvsCategoryId})}"
                           class="btn btn-outline-secondary me-2">
                            <i class="fas fa-times me-2"></i>
                            Hủy
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            Cập nhật
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Quick Guide -->
        <div class="form-card mt-4">
            <h5 class="section-title mb-3">
                <i class="fas fa-lightbulb"></i>
                Thông tin danh mục
            </h5>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="d-flex align-items-start">
                        <i class="fas fa-calendar-alt text-primary me-3 mt-1"></i>
                        <div>
                            <strong>Ngày tạo</strong>
                            <p class="text-muted small mb-0"
                               th:text="${#temporals.format(LvsCategory.lvsCreatedAt, 'dd/MM/yyyy HH:mm')}"></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="d-flex align-items-start">
                        <i class="fas fa-sync-alt text-success me-3 mt-1"></i>
                        <div>
                            <strong>Ngày cập nhật</strong>
                            <p class="text-muted small mb-0"
                               th:if="${LvsCategory.lvsUpdatedAt != null}"
                               th:text="${#temporals.format(LvsCategory.lvsUpdatedAt, 'dd/MM/yyyy HH:mm')}">
                                Chưa cập nhật
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="d-flex align-items-start">
                        <i class="fas fa-project-diagram text-warning me-3 mt-1"></i>
                        <div>
                            <strong>ID Danh mục</strong>
                            <p class="text-muted small mb-0" th:text="${LvsCategory.lvsCategoryId}"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div layout:fragment="scripts">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Character counter for description
            const descriptionInput = document.getElementById('description');
            const charCount = document.getElementById('charCount');

            if (descriptionInput && charCount) {
                descriptionInput.addEventListener('input', function() {
                    charCount.textContent = this.value.length;
                });
            }

            // Icon selection
            const iconOptions = document.querySelectorAll('.icon-option');
            const iconInput = document.getElementById('iconInput');
            const iconPreview = document.getElementById('iconPreview');
            const iconText = document.getElementById('iconText');

            // Set active icon based on current value
            const currentIcon = iconInput.value;
            iconOptions.forEach(option => {
                if (option.getAttribute('data-icon') === currentIcon) {
                    option.classList.add('active');
                }
            });

            iconOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const iconValue = this.getAttribute('data-icon');

                    // Update all icons
                    iconOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    // Update input and preview
                    iconInput.value = iconValue;
                    iconPreview.className = iconValue;
                    iconText.textContent = iconValue;
                });
            });

            // Real-time icon preview
            if (iconInput) {
                iconInput.addEventListener('input', function() {
                    const value = this.value.trim();
                    if (value) {
                        iconPreview.className = value;
                        iconText.textContent = value;

                        // Update active icon
                        iconOptions.forEach(opt => {
                            if (opt.getAttribute('data-icon') === value) {
                                iconOptions.forEach(o => o.classList.remove('active'));
                                opt.classList.add('active');
                            }
                        });
                    }
                });
            }

            // Color selection
            const colorOptions = document.querySelectorAll('.color-option');
            const colorInput = document.getElementById('colorInput');
            const colorPreview = document.getElementById('colorPreview');
            const colorText = document.getElementById('colorText');

            // Set active color based on current value
            const currentColor = colorInput.value;
            colorOptions.forEach(option => {
                if (option.getAttribute('data-color') === currentColor) {
                    option.classList.add('active');
                }
            });

            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const colorValue = this.getAttribute('data-color');

                    // Update all colors
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');

                    // Update input and preview
                    colorInput.value = colorValue;
                    colorPreview.style.backgroundColor = colorValue;
                    colorText.textContent = colorValue;
                });
            });

            // Real-time color preview
            if (colorInput) {
                colorInput.addEventListener('input', function() {
                    let value = this.value.trim();
                    if (value && !value.startsWith('#')) {
                        value = '#' + value;
                    }
                    if (value) {
                        colorPreview.style.backgroundColor = value;
                        colorText.textContent = value;
                    }
                });
            }
        });

        function openColorPicker() {
            const colorInput = document.getElementById('colorInput');
            const currentColor = colorInput.value || '#4361ee';
            const newColor = prompt('Nhập mã màu (ví dụ: #4361ee):', currentColor);

            if (newColor) {
                colorInput.value = newColor;

                const colorPreview = document.getElementById('colorPreview');
                const colorText = document.getElementById('colorText');

                if (colorPreview) colorPreview.style.backgroundColor = newColor;
                if (colorText) colorText.textContent = newColor;
            }
        }

        function resetForm() {
            if (confirm('Bạn có chắc muốn khôi phục về giá trị ban đầu? Tất cả thay đổi sẽ bị mất.')) {
                location.reload();
            }
        }

        // Form validation
        document.getElementById('editCategoryForm')?.addEventListener('submit', function(e) {
            const nameInput = document.getElementById('categoryName');
            if (!nameInput?.value.trim()) {
                e.preventDefault();
                alert('Vui lòng nhập tên danh mục!');
                nameInput.focus();
                return false;
            }

            if (nameInput.value.trim().length > 100) {
                e.preventDefault();
                alert('Tên danh mục không được vượt quá 100 ký tự!');
                nameInput.focus();
                return false;
            }

            return true;
        });
    </script>
</div>
</body>
</html>