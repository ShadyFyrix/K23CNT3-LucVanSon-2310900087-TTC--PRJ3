<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{LvsAreas/LvsUsers/LvsLayout/LvsUser-layout}">

<head>
    <title>My Purchases - Electro Store</title>
</head>

<body>
    <div layout:fragment="content">
        <div class="container mx-auto px-4 py-8">
            <!-- Header -->
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold text-white">
                    <i class="fas fa-shopping-bag mr-3 text-[#fed700]"></i>My Purchases
                </h1>
                <a th:href="@{/LvsUser/LvsProject/LvsList}"
                    class="bg-[#fed700] text-black font-bold px-6 py-3 rounded-lg hover:bg-white transition">
                    <i class="fas fa-plus mr-2"></i>Browse Projects
                </a>
            </div>

            <!-- Status Filter -->
            <div class="bg-[#2b2b2b] border border-[#333] rounded-xl p-6 mb-6">
                <div class="flex flex-wrap gap-3">
                    <a th:href="@{/LvsUser/LvsOrder/LvsMyOrders}"
                        th:classappend="${LvsSelectedStatus == null ? 'bg-[#fed700] text-black' : 'bg-[#1e1e1e] text-gray-400 hover:text-white'}"
                        class="px-6 py-2 rounded-lg font-bold transition border border-[#333]">
                        <i class="fas fa-list mr-2"></i>All Orders
                    </a>
                    <a th:each="status : ${LvsStatuses}" th:href="@{/LvsUser/LvsOrder/LvsMyOrders(lvsStatus=${status})}"
                        th:classappend="${LvsSelectedStatus == status.toString() ? 'bg-[#fed700] text-black' : 'bg-[#1e1e1e] text-gray-400 hover:text-white'}"
                        class="px-6 py-2 rounded-lg font-bold transition border border-[#333]">
                        <i th:class="${status == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PENDING ? 'fas fa-clock' : 
                                      status == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PROCESSING ? 'fas fa-spinner' :
                                      status == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).COMPLETED ? 'fas fa-check-circle' :
                                      status == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).CANCELLED ? 'fas fa-times-circle' :
                                      status == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).REFUNDED ? 'fas fa-undo' :
                                      'fas fa-question'}" class="mr-2"></i>
                        <span th:text="${status}">Status</span>
                    </a>
                </div>
            </div>

            <!-- Empty State -->
            <div th:if="${LvsOrders == null or LvsOrders.isEmpty()}" class="text-center py-16">
                <div class="bg-[#2b2b2b] border border-[#333] rounded-xl p-12">
                    <i class="fas fa-shopping-bag text-6xl text-gray-600 mb-4"></i>
                    <p class="text-gray-400 text-xl mb-6">No purchases found</p>
                    <a th:href="@{/LvsUser/LvsProject/LvsList}"
                        class="inline-block bg-[#fed700] text-black font-bold px-8 py-3 rounded-lg hover:bg-white transition">
                        <i class="fas fa-gamepad mr-2"></i>Browse Projects
                    </a>
                </div>
            </div>

            <!-- Orders List -->
            <div th:if="${LvsOrders != null and !LvsOrders.isEmpty()}" class="space-y-4">
                <div th:each="order : ${LvsOrders}"
                    class="bg-[#2b2b2b] border border-[#333] rounded-xl overflow-hidden hover:border-[#fed700] transition">
                    <div class="p-6">
                        <!-- Order Header -->
                        <div class="flex flex-wrap items-start justify-between gap-4 mb-4 pb-4 border-b border-[#333]">
                            <div>
                                <h3 class="text-white font-bold text-lg mb-1">
                                    Order #<span th:text="${order.lvsOrderId}">0</span>
                                </h3>
                                <p class="text-gray-400 text-sm">
                                    <i class="far fa-calendar mr-1"></i>
                                    <span
                                        th:text="${#temporals.format(order.lvsCreatedAt, 'dd/MM/yyyy HH:mm')}">Date</span>
                                </p>
                            </div>
                            <div class="flex items-center gap-3">
                                <!-- Status Badge -->
                                <span th:class="${order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PENDING ? 'bg-yellow-500/20 text-yellow-400 border-yellow-500' :
                                                 order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PROCESSING ? 'bg-blue-500/20 text-blue-400 border-blue-500' :
                                                 order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).COMPLETED ? 'bg-green-500/20 text-green-400 border-green-500' :
                                                 order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).CANCELLED ? 'bg-red-500/20 text-red-400 border-red-500' :
                                                 order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).REFUNDED ? 'bg-orange-500/20 text-orange-400 border-orange-500' :
                                                 'bg-gray-500/20 text-gray-400 border-gray-500'}"
                                    class="px-4 py-2 rounded-full text-sm font-bold border">
                                    <i th:class="${order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PENDING ? 'fas fa-clock' :
                                                  order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PROCESSING ? 'fas fa-spinner fa-spin' :
                                                  order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).COMPLETED ? 'fas fa-check-circle' :
                                                  order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).CANCELLED ? 'fas fa-times-circle' :
                                                  order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).REFUNDED ? 'fas fa-undo' :
                                                  'fas fa-question'}" class="mr-1"></i>
                                    <span th:text="${order.lvsStatus}">Status</span>
                                </span>
                            </div>
                        </div>

                        <!-- Order Items Preview -->
                        <div class="mb-4">
                            <div th:if="${order.lvsOrderItems != null and !order.lvsOrderItems.isEmpty()}"
                                class="flex flex-wrap gap-3">
                                <div th:each="item, iterStat : ${order.lvsOrderItems}" th:if="${iterStat.index < 3}"
                                    class="flex items-center gap-3 bg-[#1e1e1e] border border-[#333] rounded-lg p-3">
                                    <div
                                        class="w-16 h-16 bg-[#2b2b2b] rounded flex items-center justify-center flex-shrink-0">
                                        <img th:if="${item.lvsProject?.lvsThumbnailUrl}"
                                            th:src="@{${item.lvsProject.lvsThumbnailUrl}}"
                                            class="w-full h-full object-cover rounded" alt="Project">
                                        <i th:unless="${item.lvsProject?.lvsThumbnailUrl}"
                                            class="fas fa-gamepad text-gray-600 text-2xl"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-white font-bold text-sm truncate"
                                            th:text="${item.lvsProject?.lvsProjectName}">Project</p>
                                        <p class="text-gray-400 text-xs">
                                            Qty: <span th:text="${item.lvsQuantity}">1</span>
                                        </p>
                                    </div>
                                </div>
                                <div th:if="${order.lvsOrderItems.size() > 3}"
                                    class="flex items-center justify-center bg-[#1e1e1e] border border-[#333] rounded-lg px-4 py-3">
                                    <span class="text-gray-400 text-sm">
                                        +<span th:text="${order.lvsOrderItems.size() - 3}">0</span> more
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Order Footer -->
                        <div class="flex flex-wrap items-center justify-between gap-4 pt-4 border-t border-[#333]">
                            <div>
                                <p class="text-gray-400 text-sm mb-1">Total Amount:</p>
                                <p class="text-[#fed700] font-bold text-2xl">
                                    <i class="fas fa-coins mr-1"></i>
                                    <span
                                        th:text="${#numbers.formatDecimal(order.lvsFinalAmount, 0, 'COMMA', 0, 'POINT')}">0</span>
                                </p>
                            </div>
                            <div class="flex gap-3">
                                <a th:href="@{/LvsUser/LvsOrder/LvsDetail/{id}(id=${order.lvsOrderId})}"
                                    class="bg-[#1e1e1e] border border-[#444] text-white px-6 py-2 rounded-lg hover:border-[#fed700] transition font-bold">
                                    <i class="fas fa-eye mr-2"></i>View Details
                                </a>

                                <!-- Quick Actions based on status -->
                                <form
                                    th:if="${order.lvsStatus == T(k23cnt3.lucvanson.project3.LvsEntity.LvsOrder.LvsOrderStatus).PENDING}"
                                    th:action="@{/LvsUser/LvsOrder/LvsPay/{id}(id=${order.lvsOrderId})}" method="post"
                                    class="inline">
                                    <button type="submit"
                                        class="bg-[#fed700] text-black px-6 py-2 rounded-lg hover:bg-white transition font-bold">
                                        <i class="fas fa-credit-card mr-2"></i>Pay Now
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div th:if="${LvsOrders.totalPages > 1}" class="flex justify-center gap-2 mt-8">
                    <a th:if="${LvsOrders.hasPrevious()}"
                        th:href="@{/LvsUser/LvsOrder/LvsMyOrders(page=${LvsCurrentPage - 1}, lvsStatus=${LvsSelectedStatus})}"
                        class="bg-[#2b2b2b] border border-[#333] text-white px-4 py-2 rounded-lg hover:border-[#fed700] transition">
                        <i class="fas fa-chevron-left"></i>
                    </a>

                    <span class="bg-[#fed700] text-black px-4 py-2 rounded-lg font-bold">
                        Page <span th:text="${LvsCurrentPage + 1}">1</span> of <span
                            th:text="${LvsOrders.totalPages}">1</span>
                    </span>

                    <a th:if="${LvsOrders.hasNext()}"
                        th:href="@{/LvsUser/LvsOrder/LvsMyOrders(page=${LvsCurrentPage + 1}, lvsStatus=${LvsSelectedStatus})}"
                        class="bg-[#2b2b2b] border border-[#333] text-white px-4 py-2 rounded-lg hover:border-[#fed700] transition">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>

</html>