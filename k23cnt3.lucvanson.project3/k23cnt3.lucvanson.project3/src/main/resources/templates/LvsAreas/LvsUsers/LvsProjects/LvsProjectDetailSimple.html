<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Project Detail Test</title>
    <style>
        body {
            background: #1e1e1e;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .error {
            background: #ff0000;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Project Detail - Simple Test</h1>

        <div th:if="${project == null}" class="error">
            <p>ERROR: Project is NULL!</p>
        </div>

        <div th:if="${project != null}">
            <h2>Project Found!</h2>
            <p><strong>ID:</strong> <span th:text="${project.lvsProjectId}">0</span></p>
            <p><strong>Name:</strong> <span th:text="${project.lvsProjectName}">N/A</span></p>
            <p><strong>Price:</strong> <span th:text="${project.lvsPrice}">0</span></p>
            <p><strong>Description:</strong> <span th:text="${project.lvsDescription}">N/A</span></p>
            <p><strong>Thumbnail:</strong> <span th:text="${project.lvsThumbnailUrl}">N/A</span></p>
            <p><strong>Category:</strong> <span th:text="${project.lvsCategory?.lvsCategoryName ?: 'N/A'}">N/A</span>
            </p>
            <p><strong>User:</strong> <span th:text="${project.lvsUser?.lvsUsername ?: 'N/A'}">N/A</span></p>

            <div th:if="${project.lvsThumbnailUrl != null}">
                <h3>Image:</h3>
                <img th:src="@{${project.lvsThumbnailUrl}}" style="max-width: 400px;" alt="Project Image">
            </div>

            <!-- Purchase Section -->
            <div style="margin-top: 30px; padding: 20px; background: #2a2a2a; border-radius: 10px;">
                <h3 style="color: #fed700; margin-bottom: 15px;">
                    <i class="fas fa-shopping-cart"></i> Thông tin mua hàng
                </h3>

                <!-- User Coin Balance -->
                <div th:if="${session.LvsCurrentUser}" style="margin-bottom: 15px;">
                    <p style="margin: 5px 0;">
                        <strong>Số dư coin của bạn:</strong>
                        <span style="color: #fed700;"
                            th:text="${#numbers.formatDecimal(session.LvsCurrentUser.lvsCoin, 0, 0)}">0</span>
                        <i class="fas fa-coins" style="color: #fed700;"></i>
                    </p>
                </div>

                <!-- Project Price -->
                <div style="margin-bottom: 20px;">
                    <p style="margin: 5px 0; font-size: 24px;">
                        <strong>Giá:</strong>
                        <span style="color: #4ade80;"
                            th:text="${#numbers.formatDecimal(project.lvsPrice, 0, 0)}">0</span>
                        <i class="fas fa-coins" style="color: #fed700;"></i>
                    </p>
                </div>

                <!-- Success/Error Messages -->
                <div th:if="${success}"
                    style="background: #4ade80; color: #000; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <i class="fas fa-check-circle"></i> <span th:text="${success}"></span>
                </div>
                <div th:if="${error}"
                    style="background: #ff4444; color: #fff; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <i class="fas fa-exclamation-circle"></i> <span th:text="${error}"></span>
                </div>

                <!-- Purchase Button -->
                <div th:if="${session.LvsCurrentUser}">
                    <form th:if="${!LvsHasPurchased}"
                        th:action="@{/LvsUser/LvsProject/LvsPurchase/{id}(id=${project.lvsProjectId})}" method="post"
                        onsubmit="return confirm('Bạn có chắc chắn muốn mua dự án này?');">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                        <button type="submit" th:disabled="${session.LvsCurrentUser.lvsCoin < project.lvsPrice}" style="background: linear-gradient(135deg, #fed700 0%, #ffa500 100%); 
                                       color: #000; 
                                       border: none; 
                                       padding: 15px 40px; 
                                       font-size: 18px; 
                                       font-weight: bold; 
                                       border-radius: 8px; 
                                       cursor: pointer;
                                       width: 100%;
                                       transition: all 0.3s ease;">
                            <i class="fas fa-shopping-cart"></i> Mua ngay
                        </button>
                        <p th:if="${session.LvsCurrentUser.lvsCoin < project.lvsPrice}"
                            style="color: #ff4444; margin-top: 10px; font-size: 14px;">
                            <i class="fas fa-exclamation-triangle"></i> Số dư coin không đủ
                        </p>
                    </form>

                    <div th:if="${LvsHasPurchased}"
                        style="background: #4ade80; color: #000; padding: 15px; border-radius: 8px; text-align: center;">
                        <i class="fas fa-check-circle" style="font-size: 24px;"></i>
                        <p style="margin: 10px 0 0 0; font-weight: bold;">Bạn đã mua dự án này</p>
                    </div>
                </div>

                <div th:unless="${session.LvsCurrentUser}" style="text-align: center;">
                    <p style="color: #fed700; margin-bottom: 15px;">Vui lòng đăng nhập để mua dự án</p>
                    <a th:href="@{/LvsLogin}" style="background: #fed700; 
                              color: #000; 
                              padding: 15px 40px; 
                              text-decoration: none; 
                              border-radius: 8px; 
                              font-weight: bold;
                              display: inline-block;">
                        <i class="fas fa-sign-in-alt"></i> Đăng nhập
                    </a>
                </div>
            </div>
        </div>

        <hr>
        <p><a th:href="@{/LvsUser/LvsProject/LvsList}" style="color: #fed700;">Back to List</a></p>
    </div>
</body>

</html>