<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{LvsAreas/LvsUsers/LvsLayout/LvsUser-layout}">

<head>
    <title th:text="${project?.lvsProjectName ?: 'Project'} + ' - Electro Store'">Project Detail - Electro Store</title>
</head>

<body>
    <div layout:fragment="content" class="min-h-screen">
        <!-- Success/Error Messages -->
        <div th:if="${param.success}" class="container mx-auto px-4 pt-4">
            <div class="bg-green-500/20 border border-green-500 text-green-400 px-6 py-4 rounded-lg mb-4">
                <i class="fas fa-check-circle mr-2"></i>
                <span th:text="${param.success}">Success message</span>
            </div>
        </div>
        <div th:if="${param.error}" class="container mx-auto px-4 pt-4">
            <div class="bg-red-500/20 border border-red-500 text-red-400 px-6 py-4 rounded-lg mb-4">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span th:text="${param.error}">Error message</span>
            </div>
        </div>

        <!-- Breadcrumb -->
        <div class="bg-[#1e1e1e] border-b border-[#333]">
            <div class="container mx-auto px-4 py-4 flex items-center gap-2 text-sm text-gray-400">
                <a th:href="@{/LvsUser/LvsHome}" class="hover:text-[#fed700] transition">
                    <i class="fas fa-home mr-1"></i>Home
                </a>
                <i class="fas fa-chevron-right text-xs"></i>
                <a th:href="@{/LvsUser/LvsProject/LvsList}" class="hover:text-[#fed700] transition">Browse Projects</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <span class="text-white font-medium" th:text="${project?.lvsProjectName ?: 'Project'}">Project
                    Name</span>
            </div>
        </div>

        <section class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2">
                    <!-- Project Header -->
                    <div class="bg-[#2b2b2b] rounded-xl border border-[#333] p-8 mb-6">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <div class="flex items-center gap-3 mb-3">
                                    <span th:if="${project?.lvsCategory != null}"
                                        class="text-[#fed700] text-xs font-bold px-3 py-1 border border-[#fed700] rounded-full uppercase tracking-wider"
                                        th:text="${project.lvsCategory.lvsCategoryName}">Category</span>
                                    <span
                                        class="text-green-400 text-xs font-bold px-3 py-1 bg-green-500/20 border border-green-500 rounded-full">
                                        <i class="fas fa-check-circle mr-1"></i>VERIFIED
                                    </span>
                                </div>
                                <h1 class="text-4xl font-bold text-white mb-2"
                                    th:text="${project?.lvsProjectName ?: 'Project'}">
                                    Project Name</h1>
                                <p class="text-gray-400">
                                    by <a href="#" class="text-[#fed700] hover:underline"
                                        th:text="${project.lvsUser?.lvsUsername ?: 'Unknown'}">Creator</a>
                                </p>
                            </div>
                            <!-- Report Button -->
                            <a th:href="@{/LvsUser/LvsReport/LvsCreate(lvsReportType='PROJECT', lvsTargetId=${project.lvsProjectId})}"
                                class="px-4 py-2 bg-red-600/20 border border-red-600 text-red-400 rounded-lg hover:bg-red-600/30 transition flex items-center gap-2"
                                title="Report this project">
                                <i class="fas fa-flag"></i>
                                <span>Report</span>
                            </a>
                        </div>

                        <!-- Project Image Gallery -->
                        <div class="border border-[#333] rounded-lg overflow-hidden bg-[#1e1e1e] mb-6">
                            <!-- Main Image Display -->
                            <div id="mainImageContainer" class="relative">
                                <img id="mainImage" th:if="${project?.lvsThumbnailUrl != null}"
                                    th:src="@{${project.lvsThumbnailUrl}}" class="w-full h-96 object-cover"
                                    alt="Project Image">
                                <div th:unless="${project?.lvsThumbnailUrl != null}"
                                    class="w-full h-96 flex items-center justify-center">
                                    <i class="fas fa-gamepad text-gray-600 text-9xl"></i>
                                </div>

                                <!-- Navigation Arrows (shown when multiple images exist) -->
                                <button id="prevBtn" onclick="changeImage(-1)"
                                    class="hidden absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button id="nextBtn" onclick="changeImage(1)"
                                    class="hidden absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition">
                                    <i class="fas fa-chevron-right"></i>
                                </button>

                                <!-- Image Counter -->
                                <div id="imageCounter"
                                    class="hidden absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm">
                                    <span id="currentImageNum">1</span> / <span id="totalImages">1</span>
                                </div>
                            </div>

                            <!-- Thumbnail Gallery -->
                            <div id="thumbnailGallery" class="hidden bg-[#1e1e1e] p-4 border-t border-[#333]">
                                <div class="flex gap-2 overflow-x-auto" id="thumbnailContainer">
                                    <!-- Thumbnails will be inserted here by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Stats -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-[#1e1e1e] border border-[#333] rounded-lg p-4 text-center">
                                <div class="flex text-[#fed700] text-sm justify-center mb-2">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <p class="text-gray-400 text-xs" th:text="${project?.lvsReviewCount ?: 0} + ' Reviews'">
                                    0
                                    Reviews</p>
                            </div>
                            <div class="bg-[#1e1e1e] border border-[#333] rounded-lg p-4 text-center">
                                <i class="fas fa-download text-[#fed700] text-2xl mb-2"></i>
                                <p class="text-gray-400 text-xs" th:text="${lvsDownloadCount} + ' Downloads'">0
                                    Downloads</p>
                            </div>
                            <div class="bg-[#1e1e1e] border border-[#333] rounded-lg p-4 text-center">
                                <i class="fas fa-eye text-[#fed700] text-2xl mb-2"></i>
                                <p class="text-gray-400 text-xs" th:text="${project?.lvsViewCount ?: 0} + ' Views'">0
                                    Views</p>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="border-t border-[#333] pt-6">
                            <h2 class="text-xl font-bold text-white mb-4">
                                <i class="fas fa-info-circle text-[#fed700] mr-2"></i>About This Project
                            </h2>
                            <p class="text-gray-400 leading-relaxed whitespace-pre-line"
                                th:text="${project?.lvsDescription ?: 'No description available'}">
                                Project description goes here.
                            </p>
                        </div>

                        <!-- Reviews & Ratings Section -->
                        <div class="border-t border-[#333] pt-6 mt-6">
                            <h2 class="text-2xl font-bold text-white mb-6">
                                <i class="fas fa-star text-[#fed700] mr-2"></i>Reviews & Ratings
                            </h2>

                            <!-- Rating Summary -->
                            <div class="bg-[#1e1e1e] border border-[#333] rounded-lg p-6 mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Average Rating -->
                                    <div class="text-center">
                                        <div class="text-6xl font-bold text-[#fed700] mb-2"
                                            th:text="${#numbers.formatDecimal(LvsAverageRating, 1, 1)}">0.0</div>
                                        <div class="flex justify-center text-[#fed700] text-2xl mb-2">
                                            <i th:each="i : ${#numbers.sequence(1, 5)}"
                                                th:class="${i <= LvsAverageRating ? 'fas fa-star' : (i - 0.5 <= LvsAverageRating ? 'fas fa-star-half-alt' : 'far fa-star')}"></i>
                                        </div>
                                        <p class="text-gray-400" th:text="${LvsReviews.totalElements} + ' reviews'">0
                                            reviews</p>
                                    </div>

                                    <!-- Rating Distribution -->
                                    <div class="space-y-2">
                                        <div th:each="star : ${#numbers.sequence(5, 1, -1)}"
                                            class="flex items-center gap-3">
                                            <span class="text-gray-400 text-sm w-8" th:text="${star} + 'â˜…'">5â˜…</span>
                                            <div class="flex-1 bg-[#2b2b2b] rounded-full h-2 overflow-hidden">
                                                <div class="bg-[#fed700] h-full transition-all"
                                                    th:style="'width: ' + ${LvsRatingDistribution.containsKey(star) ? (LvsRatingDistribution.get(star) * 100.0 / (LvsReviews.totalElements > 0 ? LvsReviews.totalElements : 1)) : 0} + '%'">
                                                </div>
                                            </div>
                                            <span class="text-gray-400 text-sm w-12 text-right"
                                                th:text="${LvsRatingDistribution.containsKey(star) ? LvsRatingDistribution.get(star) : 0}">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Write Review Form (if purchased and not reviewed) -->
                            <div th:if="${LvsHasPurchased and !LvsHasReviewed}"
                                class="bg-[#1e1e1e] border border-[#333] rounded-lg p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4">
                                    <i class="fas fa-edit text-[#fed700] mr-2"></i>Write a Review
                                </h3>
                                <form th:action="@{/LvsUser/LvsReview/LvsWrite/{id}(id=${project.lvsProjectId})}"
                                    method="post" enctype="multipart/form-data">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                                    <!-- Rating -->
                                    <div class="mb-4">
                                        <label class="block text-gray-400 mb-2">Rating *</label>
                                        <div class="flex gap-2">
                                            <input type="radio" name="lvsRating" value="1" id="star1" class="hidden"
                                                required>
                                            <label for="star1"
                                                class="cursor-pointer text-3xl text-gray-600 hover:text-[#fed700] transition">
                                                <i class="far fa-star"></i>
                                            </label>
                                            <input type="radio" name="lvsRating" value="2" id="star2" class="hidden">
                                            <label for="star2"
                                                class="cursor-pointer text-3xl text-gray-600 hover:text-[#fed700] transition">
                                                <i class="far fa-star"></i>
                                            </label>
                                            <input type="radio" name="lvsRating" value="3" id="star3" class="hidden">
                                            <label for="star3"
                                                class="cursor-pointer text-3xl text-gray-600 hover:text-[#fed700] transition">
                                                <i class="far fa-star"></i>
                                            </label>
                                            <input type="radio" name="lvsRating" value="4" id="star4" class="hidden">
                                            <label for="star4"
                                                class="cursor-pointer text-3xl text-gray-600 hover:text-[#fed700] transition">
                                                <i class="far fa-star"></i>
                                            </label>
                                            <input type="radio" name="lvsRating" value="5" id="star5" class="hidden">
                                            <label for="star5"
                                                class="cursor-pointer text-3xl text-gray-600 hover:text-[#fed700] transition">
                                                <i class="far fa-star"></i>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Title -->
                                    <div class="mb-4">
                                        <label class="block text-gray-400 mb-2">Title</label>
                                        <input type="text" name="lvsTitle"
                                            class="w-full bg-[#2b2b2b] border border-[#333] text-white px-4 py-3 rounded-lg focus:border-[#fed700] focus:outline-none"
                                            placeholder="Summarize your experience">
                                    </div>

                                    <!-- Content -->
                                    <div class="mb-4">
                                        <label class="block text-gray-400 mb-2">Review *</label>
                                        <textarea name="lvsContent" rows="4" required
                                            class="w-full bg-[#2b2b2b] border border-[#333] text-white px-4 py-3 rounded-lg focus:border-[#fed700] focus:outline-none"
                                            placeholder="Share your thoughts about this project..."></textarea>
                                    </div>

                                    <!-- Images -->
                                    <div class="mb-4">
                                        <label class="block text-gray-400 mb-2">Images (Optional)</label>
                                        <input type="file" name="lvsImageFiles" id="reviewImageInput" multiple
                                            accept="image/*"
                                            class="w-full bg-[#2b2b2b] border border-[#333] text-white px-4 py-3 rounded-lg focus:border-[#fed700] focus:outline-none">
                                        <p class="text-gray-500 text-xs mt-1">You can upload multiple images</p>
                                        <div id="imagePreviewContainer" class="flex gap-2 mt-2 overflow-x-auto"></div>
                                    </div>

                                    <!-- Submit -->
                                    <button type="submit"
                                        class="w-full bg-[#fed700] text-black font-bold py-3 rounded-lg hover:bg-white transition">
                                        <i class="fas fa-paper-plane mr-2"></i>Submit Review
                                    </button>
                                </form>
                            </div>

                            <!-- Review List -->
                            <div class="space-y-4">
                                <div th:if="${LvsReviews.empty}" class="text-center py-12 text-gray-400">
                                    <i class="fas fa-comments text-6xl mb-4 opacity-50"></i>
                                    <p>No reviews yet. Be the first to review!</p>
                                </div>

                                <div th:each="review : ${LvsReviews.content}"
                                    class="bg-[#1e1e1e] border border-[#333] rounded-lg p-6">
                                    <!-- Review Header -->
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div
                                                class="w-12 h-12 rounded-full bg-[#fed700] flex items-center justify-center text-black font-bold text-xl">
                                                <span
                                                    th:text="${review.lvsUser.lvsUsername.substring(0,1).toUpperCase()}">U</span>
                                            </div>
                                            <div>
                                                <p class="text-white font-bold" th:text="${review.lvsUser.lvsUsername}">
                                                    Username</p>
                                                <div class="flex items-center gap-2">
                                                    <div class="flex text-[#fed700] text-sm">
                                                        <i th:each="i : ${#numbers.sequence(1, 5)}"
                                                            th:class="${i <= review.lvsRating ? 'fas fa-star' : 'far fa-star'}"></i>
                                                    </div>
                                                    <span class="text-gray-500 text-xs"
                                                        th:text="${#temporals.format(review.lvsCreatedAt, 'dd/MM/yyyy')}">Date</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button class="like-btn text-gray-400 hover:text-[#fed700] transition"
                                            th:attr="data-review-id=${review.lvsReviewId}" onclick="likeReview(this)">
                                            <i class="fas fa-thumbs-up mr-1"></i>
                                            <span class="like-count" th:text="${review.lvsLikeCount}">0</span>
                                        </button>
                                        <a th:href="@{/LvsUser/LvsReport/LvsCreate(lvsReportType='REVIEW', lvsTargetId=${review.lvsReviewId})}"
                                            class="text-red-400 hover:text-red-300 text-xs ml-3" title="Report review">
                                            <i class="fas fa-flag"></i> Report
                                        </a>
                                    </div>

                                    <!-- Review Title -->
                                    <h4 th:if="${review.lvsTitle}" class="text-white font-bold mb-2"
                                        th:text="${review.lvsTitle}">Review Title</h4>

                                    <!-- Review Content -->
                                    <p class="text-gray-400 mb-4 whitespace-pre-line" th:text="${review.lvsContent}">
                                        Review content</p>

                                    <!-- Review Images -->
                                    <div th:if="${review.lvsImages != null and !review.lvsImages.isEmpty()}"
                                        class="review-images flex gap-2 overflow-x-auto mt-4"
                                        th:attr="data-images=${review.lvsImages}">
                                        <!-- Images will be rendered by JavaScript -->
                                    </div>
                                </div>

                                <!-- Pagination -->
                                <div th:if="${LvsReviews.totalPages > 1}" class="flex justify-center gap-2 mt-6">
                                    <a th:each="i : ${#numbers.sequence(0, LvsReviews.totalPages - 1)}"
                                        th:href="@{/LvsUser/LvsProject/LvsDetail/{id}(id=${project.lvsProjectId}, page=${i})}"
                                        th:class="${i == LvsReviews.number ? 'bg-[#fed700] text-black' : 'bg-[#1e1e1e] text-white hover:bg-[#333]'}"
                                        class="px-4 py-2 rounded-lg font-bold transition" th:text="${i + 1}">1</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar - Purchase Section -->
                <div class="lg:col-span-1">
                    <div class="bg-[#2b2b2b] border border-[#333] rounded-xl p-6 sticky top-4">
                        <!-- Price Display -->
                        <div class="bg-[#2b2b2b] border-2 border-[#444] rounded-xl p-6 mb-6">
                            <!-- If discount active -->
                            <div th:if="${project.lvsHasActiveDiscount}">
                                <!-- Sale Banner -->
                                <div
                                    class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-lg text-center mb-4 animate-pulse">
                                    <i class="fas fa-fire mr-2"></i>
                                    <span class="text-2xl font-bold">
                                        <span th:text="${project.lvsDiscountPercent}">5</span>% OFF!
                                    </span>
                                    <span class="ml-2">Limited Time Offer</span>
                                </div>

                                <!-- Original Price (crossed out) -->
                                <div class="text-gray-400 text-lg line-through mb-2">
                                    Original: <span
                                        th:text="${#numbers.formatDecimal(project.lvsPrice, 0, 'COMMA', 0, 'POINT')}">10,000</span>
                                    Coins
                                </div>

                                <!-- Sale Price (highlighted) -->
                                <p class="text-5xl font-bold text-[#fed700] mb-4">
                                    <span
                                        th:text="${#numbers.formatDecimal(project.lvsFinalPrice, 0, 'COMMA', 0, 'POINT')}">9,500</span>
                                    <span class="text-2xl">Coins</span>
                                </p>

                                <!-- Savings -->
                                <div
                                    class="inline-block bg-green-500 text-white px-6 py-3 rounded-full font-bold text-lg">
                                    ðŸ’° You Save:
                                    <span
                                        th:text="${#numbers.formatDecimal(project.lvsPrice - project.lvsFinalPrice, 0, 'COMMA', 0, 'POINT')}">500</span>
                                    Coins!
                                </div>

                                <!-- Sale Timer (if end date exists) -->
                                <div th:if="${project.lvsDiscountEndDate != null}"
                                    class="mt-4 text-orange-400 font-semibold text-center">
                                    <i class="fas fa-clock mr-2"></i>
                                    Sale ends: <span
                                        th:text="${#temporals.format(project.lvsDiscountEndDate, 'dd/MM/yyyy HH:mm')}">03/01/2026
                                        15:04</span>
                                </div>
                            </div>

                            <!-- No discount -->
                            <div th:unless="${project.lvsHasActiveDiscount}">
                                <p class="text-5xl font-bold text-[#fed700] mb-2">
                                    <span
                                        th:text="${#numbers.formatDecimal(project.lvsPrice ?: 0, 0, 'COMMA', 0, 'POINT')}">0</span>
                                    <span class="text-2xl">Coins</span>
                                </p>
                            </div>
                        </div>

                        <!-- Your Balance -->
                        <div th:if="${session.LvsCurrentUser}"
                            class="bg-[#1e1e1e] border border-[#333] rounded-lg p-4 mb-6">
                            <p class="text-gray-400 text-sm mb-1">Your Balance:</p>
                            <p class="text-white font-bold text-xl">
                                <i class="fas fa-wallet text-[#fed700] mr-2"></i>
                                <span
                                    th:text="${#numbers.formatDecimal(session.LvsCurrentUser.lvsCoin ?: 0, 0, 'COMMA', 0, 'POINT')}">0</span>
                                <span class="text-sm text-gray-400">coins</span>
                            </p>
                        </div>

                        <!-- Success/Error Messages -->
                        <div th:if="${success}"
                            class="bg-green-500/20 border border-green-500 text-green-400 px-4 py-3 rounded-lg mb-4">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span th:text="${success}"></span>
                        </div>
                        <div th:if="${error}"
                            class="bg-red-500/20 border border-red-500 text-red-400 px-4 py-3 rounded-lg mb-4">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            <span th:text="${error}"></span>
                        </div>

                        <!-- Buy Now Form (if not purchased) -->
                        <form th:if="${session.LvsCurrentUser != null and !LvsHasPurchased}"
                            th:action="@{/LvsUser/LvsCart/LvsAddItem}" method="post">
                            <!-- CSRF Token -->
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="lvsProjectId" th:value="${project.lvsProjectId}" />
                            <input type="hidden" name="lvsQuantity" value="1" />
                            <input type="hidden" name="lvsAutoSelect" value="true" />

                            <!-- Buy Button -->
                            <button type="submit"
                                th:disabled="${session.LvsCurrentUser.lvsCoin < project.lvsFinalPrice}"
                                class="w-full bg-[#fed700] text-black font-bold py-4 rounded-lg hover:bg-white transition shadow-lg mb-3 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-bolt"></i> Buy Now
                            </button>

                            <!-- Insufficient funds warning -->
                            <p th:if="${session.LvsCurrentUser.lvsCoin < project.lvsFinalPrice}"
                                class="text-red-400 text-sm text-center mb-3">
                                <i class="fas fa-exclamation-triangle"></i> Insufficient coins
                            </p>
                        </form>

                        <!-- Already Purchased - Download Section -->
                        <div th:if="${session.LvsCurrentUser != null and LvsHasPurchased}">
                            <!-- Ownership Badge -->
                            <div class="bg-green-500/20 border border-green-500 rounded-lg p-4 mb-4 text-center">
                                <i class="fas fa-check-circle text-green-400 text-2xl mb-2"></i>
                                <p class="text-green-400 font-bold">You own this project</p>
                            </div>

                            <!-- Download Button -->
                            <a th:href="${project.lvsFileUrl}" download
                                class="block w-full bg-[#fed700] text-black font-bold py-4 rounded-lg hover:bg-white transition shadow-lg mb-4 text-center">
                                <i class="fas fa-download mr-2"></i>Download Project
                            </a>

                            <!-- File Information -->
                            <div class="bg-[#1e1e1e] border border-[#333] rounded-lg p-4 mb-4">
                                <h3 class="text-white font-bold mb-3 flex items-center gap-2">
                                    <i class="fas fa-file-archive text-[#fed700]"></i>
                                    Download Information
                                </h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">File Type:</span>
                                        <span class="text-white font-mono">.zip</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Size:</span>
                                        <span class="text-white">~50 MB</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Version:</span>
                                        <span class="text-white">1.0.0</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Resources -->
                            <div class="space-y-2">
                                <a th:if="${project.lvsDemoUrl}" th:href="${project.lvsDemoUrl}" target="_blank"
                                    class="block w-full bg-[#1e1e1e] border border-[#444] text-white font-bold py-3 rounded-lg hover:border-[#fed700] transition text-center">
                                    <i class="fas fa-external-link-alt mr-2"></i>View Demo
                                </a>
                                <a th:if="${project.lvsSourceCodeUrl}" th:href="${project.lvsSourceCodeUrl}"
                                    target="_blank"
                                    class="block w-full bg-[#1e1e1e] border border-[#444] text-white font-bold py-3 rounded-lg hover:border-[#fed700] transition text-center">
                                    <i class="fab fa-github mr-2"></i>Source Code
                                </a>
                            </div>
                        </div>

                        <!-- Login Required -->
                        <div th:unless="${session.LvsCurrentUser}" class="text-center">
                            <a th:href="@{/LvsLogin}"
                                class="block w-full bg-[#fed700] text-black font-bold py-4 rounded-lg hover:bg-white transition shadow-lg mb-3">
                                <i class="fas fa-sign-in-alt mr-2"></i>Login to Purchase
                            </a>
                        </div>

                        <!-- Add to Cart (if not purchased) -->
                        <form th:if="${session.LvsCurrentUser != null and !LvsHasPurchased}"
                            th:action="@{/LvsUser/LvsCart/LvsAddItem}" method="post" class="mb-3">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="lvsProjectId" th:value="${project.lvsProjectId}">
                            <input type="hidden" name="lvsQuantity" value="1">
                            <button type="submit"
                                class="w-full bg-[#1e1e1e] border border-[#444] text-white font-bold py-3 rounded-lg hover:border-[#fed700] transition flex items-center justify-center gap-2">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                        </form>

                        <!-- Gift to Follower Form -->
                        <form th:if="${session.LvsCurrentUser != null}" th:action="@{/LvsUser/LvsCart/LvsAddGiftItem}"
                            method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <input type="hidden" name="lvsProjectId" th:value="${project.lvsProjectId}" />

                            <button type="submit"
                                class="w-full bg-purple-600 text-white font-bold py-3 rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2 mb-3">
                                <i class="fas fa-gift"></i> Gift to Follower
                            </button>
                        </form>

                        <!-- Get Promo Code Button -->
                        <button onclick="showPromoModal()"
                            class="w-full bg-gradient-to-r from-[#fed700] to-[#ffa500] text-black font-bold py-3 rounded-lg hover:from-[#ffa500] hover:to-[#fed700] transition flex items-center justify-center gap-2 shadow-lg">
                            <i class="fas fa-tags"></i> Get Promo Code
                        </button>

                        <!-- Project Info -->
                        <div class="border-t border-[#333] mt-6 pt-6 space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Project ID:</span>
                                <span class="text-white font-mono" th:text="'#' + ${project.lvsProjectId}">#001</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Created:</span>
                                <span class="text-white"
                                    th:text="${#temporals.format(project.lvsCreatedAt, 'dd/MM/yyyy')}">Date</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Last Updated:</span>
                                <span class="text-white"
                                    th:text="${#temporals.format(project.lvsUpdatedAt, 'dd/MM/yyyy')}">Date</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gift Modal -->
        <div id="giftModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
            <div class="bg-[#2b2b2b] border border-[#333] rounded-xl p-8 max-w-md w-full">
                <h2 class="text-2xl font-bold text-white mb-6">
                    <i class="fas fa-gift text-purple-500 mr-2"></i>Gift Project
                </h2>

                <form th:action="@{/LvsUser/LvsGift/LvsSend}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="hidden" name="projectId" th:value="${project.lvsProjectId}">

                    <!-- Select Follower -->
                    <div class="mb-4">
                        <label class="block text-gray-400 mb-2">Select Follower</label>
                        <select name="recipientId" required
                            class="w-full bg-[#1e1e1e] border border-[#333] text-white px-4 py-3 rounded-lg focus:border-purple-500 focus:outline-none">
                            <option value="">Choose a follower...</option>
                            <option th:each="follower : ${LvsFollowers}" th:value="${follower.lvsUserId}"
                                th:text="${follower.lvsUsername}">Follower</option>
                        </select>
                    </div>

                    <!-- Gift Message -->
                    <div class="mb-6">
                        <label class="block text-gray-400 mb-2">Message (Optional)</label>
                        <textarea name="message" rows="3"
                            class="w-full bg-[#1e1e1e] border border-[#333] text-white px-4 py-3 rounded-lg focus:border-purple-500 focus:outline-none"
                            placeholder="Add a personal message..."></textarea>
                    </div>

                    <!-- Buttons -->
                    <div class="flex gap-3">
                        <button type="submit"
                            class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-lg transition">
                            <i class="fas fa-gift mr-2"></i>Send Gift
                        </button>
                        <button type="button" onclick="hideGiftModal()"
                            class="flex-1 bg-[#1e1e1e] hover:bg-[#333] text-white font-bold py-3 rounded-lg transition">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Promo Code Modal -->
        <div id="promoModal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
            <div class="bg-[#2b2b2b] border border-[#333] rounded-xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-tags text-[#fed700] mr-2"></i>Available Promo Codes
                    </h2>
                    <button onclick="hidePromoModal()" class="text-gray-400 hover:text-white transition">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <!-- Promotions List -->
                <div th:if="${LvsValidPromotions != null and !LvsValidPromotions.isEmpty()}" class="space-y-4">
                    <div th:each="promo : ${LvsValidPromotions}"
                        class="bg-[#1e1e1e] border border-[#444] rounded-lg p-4 hover:border-[#fed700] transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-grow">
                                <!-- Promo Name -->
                                <h3 class="text-white font-bold text-lg mb-2" th:text="${promo.lvsName}">Summer Sale
                                </h3>

                                <!-- Promo Code -->
                                <div class="bg-[#2b2b2b] border border-[#555] rounded-lg p-3 mb-3">
                                    <p class="text-gray-400 text-xs mb-1">Code:</p>
                                    <div class="flex items-center justify-between">
                                        <code class="text-[#fed700] font-mono font-bold text-xl"
                                            th:text="${promo.lvsCode}"
                                            th:id="'promo-code-' + ${promo.lvsPromotionId}">SUMMER2024</code>
                                        <button
                                            th:attr="data-code=${promo.lvsCode},data-promo-id=${promo.lvsPromotionId}"
                                            onclick="copyPromoCode(this.dataset.code, this.dataset.promoId)"
                                            class="bg-[#fed700] text-black px-4 py-2 rounded text-sm font-bold hover:bg-white transition">
                                            <i class="fas fa-copy mr-1"></i>Copy
                                        </button>
                                    </div>
                                </div>

                                <!-- Discount Info -->
                                <div class="flex items-center gap-4 mb-3">
                                    <div class="bg-green-500/20 border border-green-500 rounded-lg px-3 py-1">
                                        <span class="text-green-400 font-bold text-sm">
                                            <span
                                                th:if="${promo.lvsDiscountType == T(k23cnt3.lucvanson.project3.LvsEntity.LvsPromotion.LvsDiscountType).PERCENT}">
                                                <i class="fas fa-percent mr-1"></i><span
                                                    th:text="${promo.lvsDiscountValue}">20</span>% OFF
                                            </span>
                                            <span
                                                th:unless="${promo.lvsDiscountType == T(k23cnt3.lucvanson.project3.LvsEntity.LvsPromotion.LvsDiscountType).PERCENT}">
                                                <i class="fas fa-coins mr-1"></i><span
                                                    th:text="${#numbers.formatDecimal(promo.lvsDiscountValue, 0, 'COMMA', 0, 'POINT')}">5,000</span>
                                                Coins OFF
                                            </span>
                                        </span>
                                    </div>
                                </div>

                                <!-- Details -->
                                <div class="space-y-1 text-sm text-gray-400">
                                    <p th:if="${promo.lvsMinOrderValue != null and promo.lvsMinOrderValue > 0}">
                                        <i class="fas fa-shopping-cart text-[#fed700] mr-2 w-4"></i>
                                        Min. order: <span class="text-white"
                                            th:text="${#numbers.formatDecimal(promo.lvsMinOrderValue, 0, 'COMMA', 0, 'POINT')}">10,000</span>
                                        coins
                                    </p>
                                    <p>
                                        <i class="fas fa-calendar text-[#fed700] mr-2 w-4"></i>
                                        Valid until: <span class="text-white"
                                            th:text="${#temporals.format(promo.lvsEndDate, 'dd/MM/yyyy')}">31/12/2024</span>
                                    </p>
                                    <p>
                                        <i class="fas fa-users text-[#fed700] mr-2 w-4"></i>
                                        Used: <span class="text-white" th:text="${promo.lvsUsedCount}">45</span>/<span
                                            th:text="${promo.lvsUsageLimit}">100</span>
                                    </p>
                                </div>
                            </div>

                            <!-- Apply Button -->
                            <form th:action="@{/LvsUser/LvsCart/LvsApplyPromotion}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <input type="hidden" name="lvsPromotionCode" th:value="${promo.lvsCode}" />
                                <button type="submit"
                                    class="bg-[#fed700] text-black font-bold px-6 py-3 rounded-lg hover:bg-white transition whitespace-nowrap">
                                    <i class="fas fa-check mr-1"></i>Apply
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div th:if="${LvsValidPromotions == null or LvsValidPromotions.isEmpty()}" class="text-center py-12">
                    <i class="fas fa-tags text-6xl text-gray-600 mb-4"></i>
                    <p class="text-gray-400 text-lg mb-4">No promotions available at the moment</p>
                    <p class="text-gray-500 text-sm">Check back later for exciting deals!</p>
                </div>

                <!-- View All Link -->
                <div class="mt-6 pt-6 border-t border-[#333]">
                    <a th:href="@{/lvsforum/LvsPromotion/LvsList}"
                        class="block text-center text-[#fed700] hover:text-white transition font-bold">
                        <i class="fas fa-external-link-alt mr-2"></i>View All Promotions
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <th:block layout:fragment="scripts">
        <script th:inline="javascript">
            // Image Gallery Management
            let projectImages = [];
            let currentImageIndex = 0;

            // Parse images from the lvsImages JSON field
            function initializeGallery() {
                const lvsImagesJson = /*[[${project.lvsImages != null ? project.lvsImages : ''}]]*/ '';
                const lvsThumbnailUrl = /*[[${project.lvsThumbnailUrl != null ? project.lvsThumbnailUrl : ''}]]*/ '';
                const contextPath = '/lvsforum'; // Hardcoded context path

                // Helper function to add context path
                function addContextPath(url) {
                    if (!url || url.trim() === '') return '';
                    // If URL already has context path, return as is
                    if (url.startsWith('/lvsforum')) return url;
                    // Otherwise prepend context path
                    return contextPath + url;
                }

                // Start with thumbnail if available
                if (lvsThumbnailUrl && lvsThumbnailUrl.trim() !== '') {
                    projectImages.push(addContextPath(lvsThumbnailUrl));
                }

                // Parse and add additional images from lvsImages JSON
                if (lvsImagesJson && lvsImagesJson.trim() !== '') {
                    try {
                        const additionalImages = JSON.parse(lvsImagesJson);
                        if (Array.isArray(additionalImages)) {
                            // Filter out the thumbnail to avoid duplicates and add context path
                            const uniqueImages = additionalImages
                                .filter(img => img !== lvsThumbnailUrl)
                                .map(img => addContextPath(img));
                            projectImages = projectImages.concat(uniqueImages);
                        }
                    } catch (e) {
                        console.error('Error parsing project images:', e);
                    }
                }

                // Show gallery controls if there are multiple images
                if (projectImages.length > 1) {
                    const prevBtn = document.getElementById('prevBtn');
                    const nextBtn = document.getElementById('nextBtn');
                    const imageCounter = document.getElementById('imageCounter');
                    const thumbnailGallery = document.getElementById('thumbnailGallery');

                    if (prevBtn) prevBtn.classList.remove('hidden');
                    if (nextBtn) nextBtn.classList.remove('hidden');
                    if (imageCounter) imageCounter.classList.remove('hidden');
                    if (thumbnailGallery) thumbnailGallery.classList.remove('hidden');

                    // Update total images count
                    const totalImagesEl = document.getElementById('totalImages');
                    if (totalImagesEl) totalImagesEl.textContent = projectImages.length;

                    // Generate thumbnails
                    generateThumbnails();
                }
            }

            // Generate thumbnail gallery
            function generateThumbnails() {
                const container = document.getElementById('thumbnailContainer');
                if (!container) return;

                container.innerHTML = '';

                projectImages.forEach((imageUrl, index) => {
                    const thumbDiv = document.createElement('div');
                    thumbDiv.className = 'flex-shrink-0 cursor-pointer border-2 rounded-lg overflow-hidden transition ' +
                        (index === 0 ? 'border-[#fed700]' : 'border-transparent hover:border-[#444]');
                    thumbDiv.onclick = () => showImage(index);

                    const img = document.createElement('img');
                    img.src = imageUrl;
                    img.className = 'w-20 h-20 object-cover';
                    img.alt = 'Thumbnail ' + (index + 1);

                    thumbDiv.appendChild(img);
                    container.appendChild(thumbDiv);
                });
            }

            // Show specific image
            function showImage(index) {
                if (index < 0 || index >= projectImages.length) return;

                currentImageIndex = index;
                const mainImage = document.getElementById('mainImage');
                if (mainImage) {
                    mainImage.src = projectImages[index];
                }

                // Update counter
                const currentImageNum = document.getElementById('currentImageNum');
                if (currentImageNum) currentImageNum.textContent = index + 1;

                // Update thumbnail borders
                const container = document.getElementById('thumbnailContainer');
                if (!container) return;

                const thumbnails = container.children;
                for (let i = 0; i < thumbnails.length; i++) {
                    if (i === index) {
                        thumbnails[i].className = thumbnails[i].className.replace('border-transparent', 'border-[#fed700]');
                    } else {
                        thumbnails[i].className = thumbnails[i].className.replace('border-[#fed700]', 'border-transparent');
                    }
                }
            }

            // Change image (next/previous)
            function changeImage(direction) {
                let newIndex = currentImageIndex + direction;

                // Loop around
                if (newIndex < 0) {
                    newIndex = projectImages.length - 1;
                } else if (newIndex >= projectImages.length) {
                    newIndex = 0;
                }

                showImage(newIndex);
            }

            // Keyboard navigation
            document.addEventListener('keydown', function (e) {
                if (projectImages.length <= 1) return;

                if (e.key === 'ArrowLeft') {
                    changeImage(-1);
                } else if (e.key === 'ArrowRight') {
                    changeImage(1);
                }
            });

            // Initialize gallery on page load
            document.addEventListener('DOMContentLoaded', initializeGallery);

            // Quantity and Price Management
            function increaseQuantity() {
                const input = document.getElementById('quantity');
                const currentValue = parseInt(input.value) || 1;
                if (currentValue < 99) {
                    input.value = currentValue + 1;
                    updateTotalPrice();
                }
            }

            function decreaseQuantity() {
                const input = document.getElementById('quantity');
                const currentValue = parseInt(input.value) || 1;
                if (currentValue > 1) {
                    input.value = currentValue - 1;
                    updateTotalPrice();
                }
            }

            function updateTotalPrice() {
                const quantity = parseInt(document.getElementById('quantity').value) || 1;
                const priceElement = document.getElementById('totalPrice');
                const basePrice = parseFloat(priceElement.getAttribute('data-price')) || 0;
                const total = basePrice * quantity;

                // Format number with thousand separators
                priceElement.textContent = total.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            }

            // Confirm before purchase
            document.getElementById('buyNowForm')?.addEventListener('submit', function (e) {
                const quantity = parseInt(document.getElementById('quantity').value) || 1;
                const totalPrice = parseFloat(document.getElementById('totalPrice').getAttribute('data-price')) * quantity;
                const userBalance = parseFloat('[[${session.LvsCurrentUser?.lvsCoin ?: 0}]]');

                if (totalPrice > userBalance) {
                    e.preventDefault();
                    alert('Insufficient coins! You need ' + totalPrice.toLocaleString() + ' coins but only have ' + userBalance.toLocaleString() + ' coins.');
                    return false;
                }

                if (!confirm('Purchase this project for ' + totalPrice.toLocaleString() + ' coins?')) {
                    e.preventDefault();
                    return false;
                }
            });

            // Gift Modal Functions
            function showGiftModal() {
                document.getElementById('giftModal').classList.remove('hidden');
            }

            function hideGiftModal() {
                document.getElementById('giftModal').classList.add('hidden');
            }

            // Close modal on outside click
            document.getElementById('giftModal')?.addEventListener('click', function (e) {
                if (e.target === this) {
                    hideGiftModal();
                }
            });

            // Close modal on Escape key
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    hideGiftModal();
                    hidePromoModal();
                }
            });

            // Promo Modal Functions
            function showPromoModal() {
                document.getElementById('promoModal').classList.remove('hidden');
            }

            function hidePromoModal() {
                document.getElementById('promoModal').classList.add('hidden');
            }

            // Close promo modal on outside click
            document.getElementById('promoModal')?.addEventListener('click', function (e) {
                if (e.target === this) {
                    hidePromoModal();
                }
            });

            // Copy Promo Code Function
            function copyPromoCode(code, promoId) {
                navigator.clipboard.writeText(code).then(function () {
                    // Show success feedback
                    const button = event.target.closest('button');
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<i class="fas fa-check mr-1"></i>Copied!';
                    button.classList.add('bg-green-500');
                    button.classList.remove('bg-[#fed700]');

                    // Reset after 2 seconds
                    setTimeout(function () {
                        button.innerHTML = originalHTML;
                        button.classList.remove('bg-green-500');
                        button.classList.add('bg-[#fed700]');
                    }, 2000);
                }).catch(function (err) {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy code. Please copy manually: ' + code);
                });
            }

            // Star Rating Selection
            const starInputs = document.querySelectorAll('input[name="lvsRating"]');
            const starLabels = document.querySelectorAll('label[for^="star"]');

            starInputs.forEach((input, index) => {
                input.addEventListener('change', function () {
                    // Update all stars up to selected
                    starLabels.forEach((label, i) => {
                        const icon = label.querySelector('i');
                        if (i <= index) {
                            icon.className = 'fas fa-star text-[#fed700]';
                        } else {
                            icon.className = 'far fa-star text-gray-600';
                        }
                    });
                });
            });

            // Hover effect for stars
            starLabels.forEach((label, index) => {
                label.addEventListener('mouseenter', function () {
                    starLabels.forEach((l, i) => {
                        const icon = l.querySelector('i');
                        if (i <= index) {
                            icon.classList.add('text-[#fed700]');
                            icon.classList.remove('text-gray-600');
                        }
                    });
                });

                label.addEventListener('mouseleave', function () {
                    // Reset to selected state
                    const selectedInput = document.querySelector('input[name="lvsRating"]:checked');
                    if (selectedInput) {
                        const selectedIndex = Array.from(starInputs).indexOf(selectedInput);
                        starLabels.forEach((l, i) => {
                            const icon = l.querySelector('i');
                            if (i <= selectedIndex) {
                                icon.classList.add('text-[#fed700]');
                                icon.classList.remove('text-gray-600');
                            } else {
                                icon.classList.add('text-gray-600');
                                icon.classList.remove('text-[#fed700]');
                            }
                        });
                    } else {
                        // No selection, reset all
                        starLabels.forEach((l) => {
                            const icon = l.querySelector('i');
                            icon.classList.add('text-gray-600');
                            icon.classList.remove('text-[#fed700]');
                        });
                    }
                });
            });

            // Image Preview
            const reviewImageInput = document.getElementById('reviewImageInput');
            if (reviewImageInput) {
                reviewImageInput.addEventListener('change', function (e) {
                    const files = e.target.files;
                    const previewContainer = document.getElementById('imagePreviewContainer');

                    if (!previewContainer) return;

                    previewContainer.innerHTML = '';

                    if (files.length > 0) {
                        Array.from(files).forEach((file, index) => {
                            if (file.type.startsWith('image/')) {
                                const reader = new FileReader();
                                reader.onload = function (e) {
                                    const img = document.createElement('img');
                                    img.src = e.target.result;
                                    img.className = 'w-20 h-20 object-cover rounded border-2 border-[#fed700]';
                                    img.alt = 'Preview ' + (index + 1);
                                    previewContainer.appendChild(img);
                                };
                                reader.readAsDataURL(file);
                            }
                        });
                    }
                });
            }

            // Render Review Images from JSON
            document.addEventListener('DOMContentLoaded', function () {
                console.log('Rendering review images...');
                document.querySelectorAll('.review-images').forEach(container => {
                    const imagesJson = container.getAttribute('data-images');
                    console.log('Images JSON:', imagesJson);
                    if (imagesJson && imagesJson !== '[]' && imagesJson !== 'null') {
                        try {
                            const images = JSON.parse(imagesJson);
                            console.log('Parsed images:', images);
                            if (Array.isArray(images) && images.length > 0) {
                                container.innerHTML = '';
                                images.forEach(imageUrl => {
                                    const img = document.createElement('img');

                                    // Add context path like Thymeleaf @{} does
                                    // Context path is /lvsforum
                                    if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
                                        img.src = imageUrl;
                                    } else {
                                        // Add context path + imageUrl
                                        img.src = '/lvsforum' + imageUrl;
                                    }

                                    img.className = 'w-32 h-32 object-cover rounded-lg border border-[#333] cursor-pointer hover:border-[#fed700] transition';
                                    img.alt = 'Review image';
                                    img.onerror = function () {
                                        console.error('Failed to load image:', this.src);
                                    };
                                    container.appendChild(img);
                                });
                            }
                        } catch (e) {
                            console.error('Failed to parse review images:', e, imagesJson);
                        }
                    }
                });
            });
        </script>


        <!-- Like Review Functionality -->
        <script th:inline="javascript">
            // 24-hour cooldown using localStorage
            function canLikeReview(reviewId) {
                const key = 'like_' + reviewId;
                const lastLike = localStorage.getItem(key);

                if (!lastLike) return true;

                const now = new Date().getTime();
                const lastLikeTime = parseInt(lastLike);
                const hoursPassed = (now - lastLikeTime) / (1000 * 60 * 60);

                return hoursPassed >= 24;
            }

            function setLikeCooldown(reviewId) {
                const key = 'like_' + reviewId;
                localStorage.setItem(key, new Date().getTime().toString());
            }

            function likeReview(button) {
                const reviewId = button.getAttribute('data-review-id');

                // Check 24-hour cooldown
                if (!canLikeReview(reviewId)) {
                    alert('Báº¡n chá»‰ cÃ³ thá»ƒ like 1 láº§n trong 24 giá»!');
                    return;
                }

                button.disabled = true;
                const likeCountSpan = button.querySelector('.like-count');

                // Get CSRF token
                const csrfToken = document.querySelector('meta[name="_csrf"]')?.getAttribute('content');
                const csrfHeader = document.querySelector('meta[name="_csrf_header"]')?.getAttribute('content');

                const headers = {
                    'Content-Type': 'application/json'
                };

                // Add CSRF token if available
                if (csrfToken && csrfHeader) {
                    headers[csrfHeader] = csrfToken;
                }

                fetch('/lvsforum/LvsUser/LvsReview/LvsLike/' + reviewId, {
                    method: 'POST',
                    headers: headers
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            likeCountSpan.textContent = data.likeCount;

                            // Set 24-hour cooldown
                            setLikeCooldown(reviewId);

                            // Toggle button style
                            button.classList.add('text-[#fed700]');
                            button.classList.remove('text-gray-400');

                            alert('ÄÃ£ like! Báº¡n cÃ³ thá»ƒ like láº¡i sau 24 giá».');
                        } else {
                            alert(data.message || 'Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ like');
                            button.disabled = false;
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Lá»—i khi like review');
                        button.disabled = false;
                    });
            }
        </script>
    </th:block>
</body>

</html>