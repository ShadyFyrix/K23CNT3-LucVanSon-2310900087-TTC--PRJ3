<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body th:fragment="mobile-menu">
    <!-- Mobile Navigation Overlay -->
    <div id="mobile-menu"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden lg:hidden transition-opacity duration-300">
        <!-- Slide-in Menu -->
        <div id="mobile-menu-content"
            class="fixed inset-y-0 left-0 w-80 bg-gradient-to-b from-[#2b2b2b] to-[#1e1e1e] shadow-2xl transform -translate-x-full transition-transform duration-300 ease-out overflow-y-auto">
            <!-- Header -->
            <div
                class="flex items-center justify-between p-6 border-b border-[#444]/50 bg-[#1e1e1e]/50 backdrop-blur-sm sticky top-0 z-10">
                <h2 class="text-xl font-bold text-white">Menu</h2>
                <button onclick="toggleMobileMenu()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- User Info (Logged In) -->
            <div class="p-6 border-b border-[#444]/50" th:if="${session.LvsCurrentUser}">
                <div class="flex items-center gap-4 mb-4">
                    <div
                        class="w-14 h-14 rounded-full bg-gradient-to-br from-[#fed700] to-[#ffa500] flex items-center justify-center text-black font-bold text-2xl shadow-lg">
                        <span
                            th:text="${#strings.substring(session.LvsCurrentUser.lvsUsername, 0, 1).toUpperCase()}">U</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-bold text-lg truncate"
                            th:text="${session.LvsCurrentUser.lvsUsername}">Username</p>
                        <p class="text-gray-400 text-sm truncate" th:text="${session.LvsCurrentUser.lvsEmail}">
                            email@example.com</p>
                    </div>
                </div>
                <!-- Quick Stats -->
                <div class="grid grid-cols-2 gap-2 text-center">
                    <div class="bg-[#333]/30 rounded-lg p-2">
                        <p class="text-[#fed700] font-bold"
                            th:text="${#numbers.formatDecimal(session.LvsCurrentUser.lvsCoin ?: 0, 0, 'COMMA', 0, 'POINT')}">
                            0</p>
                        <p class="text-gray-500 text-xs">Coins</p>
                    </div>
                    <div class="bg-[#333]/30 rounded-lg p-2">
                        <p class="text-[#fed700] font-bold"
                            th:text="${#numbers.formatDecimal(session.LvsCurrentUser.lvsBalance ?: 0, 0, 'COMMA', 0, 'POINT')}">
                            0</p>
                        <p class="text-gray-500 text-xs">Balance</p>
                    </div>
                </div>
            </div>

            <!-- Login Prompt (Not Logged In) -->
            <div class="p-6 border-b border-[#444]/50" th:unless="${session.LvsCurrentUser}">
                <div class="text-center mb-4">
                    <div
                        class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-[#fed700] to-[#ffa500] flex items-center justify-center">
                        <i class="fas fa-user text-black text-3xl"></i>
                    </div>
                    <h3 class="text-white font-bold text-lg mb-2">Welcome to WeJect!</h3>
                    <p class="text-gray-400 text-sm mb-4">Login to access all features</p>
                </div>
                <div class="space-y-2">
                    <a th:href="@{/LvsLogin}" onclick="toggleMobileMenu()"
                        class="block w-full bg-gradient-to-r from-[#fed700] to-[#ffa500] text-black font-bold py-3 px-4 rounded-lg text-center hover:from-[#ffa500] hover:to-[#fed700] transition">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </a>
                    <a th:href="@{/LvsRegister}" onclick="toggleMobileMenu()"
                        class="block w-full bg-transparent border-2 border-[#fed700] text-[#fed700] font-bold py-3 px-4 rounded-lg text-center hover:bg-[#fed700]/10 transition">
                        <i class="fas fa-user-plus mr-2"></i>Register
                    </a>
                </div>
            </div>

            <!-- Navigation Links -->
            <nav class="p-4 space-y-1">
                <!-- Home -->
                <a th:href="@{/LvsUser/LvsHome}" onclick="toggleMobileMenu()"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-[#fed700]/10 to-transparent border-l-2 border-[#fed700] hover:from-[#fed700]/20 transition-all duration-200">
                    <i class="fas fa-home text-[#fed700] text-lg"></i>
                    <span class="text-white font-semibold">Home</span>
                </a>

                <!-- Admin Panel - Only for ADMIN role -->
                <a th:if="${session.LvsCurrentUser != null and session.LvsCurrentUser.lvsRole.name() == 'ADMIN'}"
                    th:href="@{/LvsAdmin/LvsDashboard}" onclick="toggleMobileMenu()"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-red-500/10 to-transparent border-l-2 border-red-500 hover:from-red-500/20 transition-all duration-200">
                    <i class="fas fa-shield-alt text-red-400 text-lg"></i>
                    <span class="text-red-400 font-bold">Admin Panel</span>
                    <span
                        class="ml-auto bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full">ADMIN</span>
                </a>

                <!-- Moderation Panel (If Admin or Moderator) -->
                <a th:if="${session.LvsCurrentUser != null and (session.LvsCurrentUser.lvsRole.name() == 'ADMIN' or session.LvsCurrentUser.lvsRole.name() == 'MODERATOR')}"
                    th:href="@{/LvsModeration/LvsDashboard}"
                    class="group flex items-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-purple-500/10 to-transparent border-l-2 border-purple-500 hover:from-purple-500/20 transition-all duration-200">
                    <div
                        class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center group-hover:scale-110 transition-transform">
                        <i class="fas fa-gavel text-purple-400 text-sm"></i>
                    </div>
                    <span class="text-purple-400 text-sm font-bold">Moderation</span>
                    <span
                        class="ml-auto bg-purple-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full">MOD</span>
                </a>

                <!-- Divider -->
                <div class="relative h-px my-3">
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-[#fed700]/30 to-transparent">
                    </div>
                </div>

                <!-- Account Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Account</p>
                    <a th:if="${session.LvsCurrentUser != null}"
                        th:href="@{/LvsUser/LvsProfile/LvsView/{id}(id=${session.LvsCurrentUser.lvsUserId})}"
                        onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-id-card text-gray-400"></i>
                        <span class="text-gray-300 text-sm">View Profile</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsProfile/LvsEdit}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-edit text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Edit Profile</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsProfile/LvsChangePassword}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-key text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Change Password</span>
                    </a>
                </div>

                <!-- Shopping Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Shopping</p>
                    <a th:href="@{/LvsUser/LvsCart/LvsView}" onclick="toggleMobileMenu()"
                        class="flex items-center justify-between px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-shopping-cart text-gray-400"></i>
                            <span class="text-gray-300 text-sm">My Cart</span>
                        </div>
                        <span th:if="${session.LvsCartItemCount != null and session.LvsCartItemCount > 0}"
                            class="bg-[#fed700] text-black text-[9px] font-bold px-2 py-0.5 rounded-full animate-bounce"
                            th:text="${session.LvsCartItemCount}">0</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsOrder/LvsMyOrders}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-box text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Orders</span>
                    </a>
                    <a th:href="@{/lvsforum/LvsPromotion/LvsList}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-tags text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Promotions</span>
                    </a>
                </div>

                <!-- Projects Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Projects</p>
                    <a th:href="@{/LvsUser/LvsProject/LvsList}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-th-large text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Browse All</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsProject/LvsMyProjects}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-folder text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Projects</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsProject/LvsAdd}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-plus-circle text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Add New</span>
                    </a>
                </div>

                <!-- Content Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Content</p>
                    <a th:href="@{/LvsUser/LvsMessage/LvsInbox}" onclick="toggleMobileMenu()"
                        class="flex items-center justify-between px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-envelope text-gray-400"></i>
                            <span class="text-gray-300 text-sm">Messages</span>
                        </div>
                        <span th:if="${session.LvsUnreadCount != null and session.LvsUnreadCount > 0}"
                            class="bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full animate-pulse"
                            th:text="${session.LvsUnreadCount}">0</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsBlog/LvsList}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-blog text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Blog</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsBlog/LvsMyPosts}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-file-alt text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Posts</span>
                    </a>
                </div>

                <!-- Social Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Social</p>
                    <a th:href="@{/LvsUser/LvsFollow/LvsMyFollowers}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-user-friends text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Followers</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsFollow/LvsMyFollowing}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-user-plus text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Following</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsReview/LvsMyReviews}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-star text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Reviews</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsComment/LvsMyComments}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-comments text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Comments</span>
                    </a>
                </div>

                <!-- Events Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Events</p>
                    <a th:href="@{/LvsUser/LvsEvent/LvsDailyCheckIn}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-calendar-check text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Daily Check-In</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsQuest/LvsDashboard}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-tasks text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Quest Dashboard</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsEvent/LvsHistory}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-history text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Event History</span>
                    </a>
                </div>

                <!-- Finance Section -->
                <div class="pt-2">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Finance</p>
                    <a th:href="@{/LvsUser/LvsTransaction/LvsHistory}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-history text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Transactions</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsProfile/LvsRevenue}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-chart-line text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Revenue</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsTransaction/LvsDeposit}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-plus-square text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Deposit</span>
                    </a>
                    <a th:href="@{/LvsUser/LvsTransaction/LvsConvert}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-exchange-alt text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Convert Balance</span>
                    </a>
                </div>

                <!-- Reports -->
                <div class="pt-2 pb-20">
                    <p class="text-gray-500 text-xs font-semibold uppercase tracking-wider px-4 py-2">Support</p>
                    <a th:href="@{/LvsUser/LvsReport/LvsMyReports}" onclick="toggleMobileMenu()"
                        class="flex items-center gap-3 px-4 py-2.5 rounded-xl hover:bg-[#fed700]/10 transition-all duration-200">
                        <i class="fas fa-flag text-gray-400"></i>
                        <span class="text-gray-300 text-sm">My Reports</span>
                    </a>
                </div>
            </nav>

            <!-- Logout Button (Fixed at bottom) - Only show when logged in -->
            <div th:if="${session.LvsCurrentUser != null}"
                class="fixed bottom-0 left-0 right-0 w-80 p-4 bg-gradient-to-t from-[#1e1e1e] via-[#1e1e1e] to-transparent">
                <a th:href="${session.LvsCurrentUser.lvsRole.name() == 'ADMIN'} ? @{/LvsAdmin/LvsLogout} : @{/LvsUser/LvsLogout}"
                    class="flex items-center justify-center gap-3 px-4 py-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 transition-all duration-200">
                    <i class="fas fa-sign-out-alt text-red-400"></i>
                    <span class="text-red-400 font-medium">Logout</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const content = document.getElementById('mobile-menu-content');

            if (menu.classList.contains('hidden')) {
                // Show menu
                menu.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Prevent body scroll
                setTimeout(() => {
                    content.classList.remove('-translate-x-full');
                }, 10);
            } else {
                // Hide menu
                content.classList.add('-translate-x-full');
                document.body.style.overflow = ''; // Restore body scroll
                setTimeout(() => {
                    menu.classList.add('hidden');
                }, 300);
            }
        }

        // Close menu when clicking outside
        document.getElementById('mobile-menu')?.addEventListener('click', function (e) {
            if (e.target === this) {
                toggleMobileMenu();
            }
        });

        // Close menu on escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const menu = document.getElementById('mobile-menu');
                if (!menu.classList.contains('hidden')) {
                    toggleMobileMenu();
                }
            }
        });

        // Swipe gesture support
        let touchStartX = 0;
        let touchEndX = 0;
        const mobileMenuContent = document.getElementById('mobile-menu-content');

        mobileMenuContent?.addEventListener('touchstart', function (e) {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        mobileMenuContent?.addEventListener('touchend', function (e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            // Swipe left to close (at least 50px)
            if (touchStartX - touchEndX > 50) {
                toggleMobileMenu();
            }
        }
    </script>
</body>

</html>